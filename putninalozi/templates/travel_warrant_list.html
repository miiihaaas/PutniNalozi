{% extends "layout.html" %} {% block content %}
<form method="POST" action="">
  {{ form.hidden_tag() }}
  <fieldset class="form-group">
  </fieldset>
  {% if current_user.authorization not in ['c_user', 'c_member'] %}
  <div id="accordionZero">
    <div class="accordion">
      <div class="accordion-item">
        <div class="accordion-header" id="headingZero">
          <button
            type="button"
            class="accordion-button collapsed centerbutton"
            data-toggle="collapse"
            data-target="#collapseZero"
            aria-expanded="false"
            aria-controls="collapseZero"
          >
            Kreiranje novog putnog naloga
          </button>
        </div>

        <div
          id="collapseZero"
          class="collapse"
          aria-labelledby="headingZero"
          data-parent="#accordionZero"
        >
          <div class="card-body">
            <div class="row">
              <div class="col form-group columnflex">
                <div class="rowflex">
                  {{ form.user_id.label(class="form-control-label") }} 
                  {% if form.user_id.errors %} 
                    {{ form.user_id(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                      {% for error in form.user_id.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                  {% else %} 
                    {{ form.user_id(class="form-select form-select-lg") }} 
                  {% endif %}
                </div>
                <small class="text-muted ml-2">
                  <a href="{{ url_for('users.register_u') }}">Registrujte novog zaposlenog </a>
                </small>
              </div>
              <div class="col form-box start-time">
                {{ form.start_datetime.label(class="form-control-label") }} 
                {% if form.start_datetime.errors %} 
                  {{ form.start_datetime(class="form-control form-control-lg is-invalid") }}
                  <div class="invalid-feedback">
                    {% for error in form.start_datetime.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                  </div>
                {% else %} 
                  {{ form.start_datetime(class="form-control form-control-lg", type="datetime-local", readonly="readonly") }} 
                {% endif %}
              </div>
              <div class="form-group">
                {{ form.submit(class="btn btn-outline-info", disabled="disabled") }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  <table id="data" border="1" class="table table-striped twlist">
    {% if current_user.authorization == 's_admin' %}
    <thead>
      <tr id="header">
        <th>Br. putnog naloga</th>
        <th>Korisnik</th>
        <th>Vozilo</th>
        <th>Kompanija</th>
        <th>Status naloga</th>
      </tr>
    </thead>
    <tbody>
      {% for warrant in warrants %}
      <tr>
        <td class="align-middle">
          <div class="btn-group">
            <a
              class="btn btn-info"
              href="{{ url_for('travel_warrants.travel_warrant_profile', warrant_id=warrant.travel_warrant_id) }}"
              role="button"
              title="Izmenite putni nalog"
            >
              {{ warrant.travel_warrant_number }}</a
            ><a
              class="btn btn-outline-info"
              href="{{ url_for('travel_warrants.download_file', file_name=warrant.file_name) }}"
              title="Preuzmite dokument"
              >&#x21E9;</a
            >
          </div>
        </td>
        <td class="align-middle">
          {{ warrant.travelwarrant_user.name }} {{ warrant.travelwarrant_user.surname }}
        </td>
        <td class="align-middle">
          {% if warrant.together_with %} 
            {% for w in warrants %}
              {% if w.travel_warrant_number == warrant.together_with %}
                {% if w.personal_vehicle_id %}
                  <img src="../../static/img/P-Light.png" alt="(P)" class="tableiconimg" title="Privatno vozilo">
                {% else %}
                  <img src="../../static/img/S-Light.png" alt="(S)" class="tableiconimg" title="Službeno vozilo">
                {% endif %}
              {% endif %}
            {% endfor %}
            <p>
            PUTUJE SA: <br />
            <b>{{warrant.together_with}} </b>
          </p>
          {% elif warrant.other %}
            <img src="../../static/img/D-Light.png" alt="(D)" class="tableiconimg" title="Dugi tip prevoza">
            {{ warrant.other }}
          {% elif warrant.personal_vehicle_id %}
            <img src="../../static/img/P-Light.png" alt="(P)" class="tableiconimg" title="Privatno vozilo">
          <p>{{ warrant.travelwarrant_personal.vehicle_type }} <br />
            {{ warrant.travelwarrant_personal.vehicle_brand }} <br />
            {{ warrant.travelwarrant_personal.vehicle_registration }}</p>
          {% else %} 
            <img src="../../static/img/S-Light.png" alt="(S)" class="tableiconimg" title="Službeno vozilo">
          <p> {{ warrant.travelwarrant_vehicle.vehicle_type}} <br />
            {{warrant.travelwarrant_vehicle.vehicle_brand}} <br />
            {{warrant.travelwarrant_vehicle.vehicle_registration}}</p>
          {% endif %}
        </td>
        <td class="align-middle">
          {{ warrant.travelwarrant_company.companyname }}
        </td>
        <td class="align-middle">{{ warrant.status }}</td>
      </tr>
      {% endfor %}
    </tbody>
    {% elif current_user.authorization in ['c_admin', 'c_functionary', 'c_founder', 'c_cashier', 'o_cashier'] %}
    <thead>
      <tr id="header">
        <th>Br.</th>
        <th>Korisnik</th>
        <th>Vozilo</th>
        <th>Datum</th>
        <th>Status naloga</th>
      </tr>
    </thead>
    <tbody>
      {% for warrant in warrants %} 
      {% if current_user.user_company.id == warrant.travelwarrant_company.id %}
      <tr class="iconwrapper">
        <td class="align-middle">
          <div class="btn-group">
            <a
              class="btn btn-info"
              href="{{ url_for('travel_warrants.travel_warrant_profile', warrant_id=warrant.travel_warrant_id) }}"
              role="button"
              title="Izmenite putni nalog"
            >
              {{ warrant.travel_warrant_number }}</a
            ><a
              class="btn btn-outline-info"
              href="{{ url_for('travel_warrants.download_file', file_name=warrant.file_name) }}"
              title="Preuzmite dokument"
              >&#x21E9;</a
            >
          </div>
        </td>
        <td class="align-middle">
          {{ warrant.travelwarrant_user.name }} {{warrant.travelwarrant_user.surname}}
        </td>
        <td class="align-middle flexvcenter">
          {% if warrant.together_with %} 
            {% for w in warrants %}
              {% if w.travel_warrant_number == warrant.together_with %}
                {% if w.personal_vehicle_id %}
                  <img src="../../static/img/P-Light.png" alt="(P)" class="tableiconimg" title="Privatno vozilo">
                {% else %}
                  <img src="../../static/img/S-Light.png" alt="(S)" class="tableiconimg" title="Službeno vozilo">
                {% endif %}
              {% endif %}
            {% endfor %}
          <p>PUTUJE SA: <br />
            <b>{{warrant.together_with}} </b></p>
          {% elif warrant.other %}
            <img src="../../static/img/D-Light.png" alt="(D)" class="tableiconimg" title="Dugi tip prevoza">
          <p>{{ warrant.other }}</p>
          {% elif warrant.personal_vehicle_id %}
            <img src="../../static/img/P-Light.png" alt="(P)" class="tableiconimg" title="Privatno vozilo">
          <p>{{ warrant.travelwarrant_personal.vehicle_type }} <br />
            {{ warrant.travelwarrant_personal.vehicle_brand }} <br />
            {{ warrant.travelwarrant_personal.vehicle_registration }}</p>
          {% else %} 
            <img src="../../static/img/S-Light.png" alt="(S)" class="tableiconimg" title="Službeno vozilo">
          <p>{{ warrant.travelwarrant_vehicle.vehicle_type}} <br />
            {{warrant.travelwarrant_vehicle.vehicle_brand}} <br />
            {{warrant.travelwarrant_vehicle.vehicle_registration}}</p>
          {% endif %}
        </td>
        <td class="align-middle">{{ warrant.start_datetime.date() }}</td>
        <td class="align-middle">{{ warrant.status }}</td>
      </tr>
      {% endif %} {% endfor %}
    </tbody>
    {% else %}
    <thead>
      <tr id="header">
        <th>Br.</th>
        <th>Korisnik</th>
        <th>Vozilo</th>
        <th>Datum</th>
        <th>Status naloga</th>
      </tr>
    </thead>
    <tbody>
      {% for warrant in warrants %} 
      {% if current_user.id == warrant.travelwarrant_user.id %}
      <tr>
        <td class="align-middle">
          <div class="btn-group">
            <a
              class="btn btn-info"
              href="{{ url_for('travel_warrants.travel_warrant_profile', warrant_id=warrant.travel_warrant_id) }}"
              role="button"
              title="Izmenite putni nalog"
            >
              {{ warrant.travel_warrant_number }}</a
            ><a
              class="btn btn-outline-info"
              href="{{ url_for('travel_warrants.download_file', file_name=warrant.file_name) }}"
              title="Preuzmite dokument"
              >&#x21E9;</a
            >
          </div>
        </td>
        <td class="align-middle">
          {{ warrant.travelwarrant_user.name }} {{ warrant.travelwarrant_user.surname}}
        </td>
        <td class="align-middle">
          {% if warrant.together_with %} 
            {% for w in warrants %}
              {% if w.travel_warrant_number == warrant.together_with %}
                {% if w.personal_vehicle_id %}
                  <img src="../../static/img/P-Light.png" alt="(P)" class="tableiconimg" title="Privatno vozilo">
                {% else %}
                  <img src="../../static/img/S-Light.png" alt="(S)" class="tableiconimg" title="Službeno vozilo">
                {% endif %}
              {% endif %}
            {% endfor %}
            PUTUJE SA: <br />
            <b>{{warrant.together_with}} </b> 
          {% elif warrant.other %}
            <img src="../../static/img/D-Light.png" alt="(D)" class="tableiconimg" title="Dugi tip prevoza">
            {{ warrant.other }}
          {% elif warrant.personal_vehicle_id %}
            <img src="../../static/img/P-Light.png" alt="(P)" class="tableiconimg" title="Privatno vozilo">
            {{ warrant.travelwarrant_personal.vehicle_type }} <br />
            {{ warrant.travelwarrant_personal.vehicle_brand }} <br />
            {{ warrant.travelwarrant_personal.vehicle_registration }}
          {% else %} 
            <img src="../../static/img/S-Light.png" alt="(S)" class="tableiconimg" title="Službeno vozilo">
            {{ warrant.travelwarrant_vehicle.vehicle_type}} <br />
            {{warrant.travelwarrant_vehicle.vehicle_brand}} <br />
            {{warrant.travelwarrant_vehicle.vehicle_registration}}
          {% endif %}
        </td>
        <td class="align-middle">{{ warrant.start_datetime.date() }}</td>
        <td class="align-middle">{{ warrant.status }}</td>
      </tr>
      {% endif %} {% endfor %}
    </tbody>
    {% endif %}
  </table>
</form>

{% endblock content%} 

{% block scripts %}
<script>
  $(document).ready(function () {
    $("#data").DataTable({
      order: [[0, "desc"]],
      language: {
        url: "//cdn.datatables.net/plug-ins/1.12.1/i18n/sr-SP.json",
        stateSave: true
      },
    });
  });
</script>

<script>
  const selectUser = $('#user_id');
  const selectDate = $('#start_datetime');
  const buttonSubmit = $('#submit');
  selectUser.on('change', function() {
    console.log(selectUser.val());
    if(parseInt(selectUser.val()) === 0){
      selectDate.val('');
      selectDate.prop('readonly', true);
      buttonSubmit.prop('disabled', true);
    } else {
      selectDate.prop('readonly', false);
      console.log('vrednost datuma je: ', selectDate.val());
    }
  })
  selectDate.on('change', function(){
    if(selectDate.val() === '') {
      console.log('nije selektovan datum')
      buttonSubmit.prop('disabled', true);
    } else {
      buttonSubmit.prop('disabled', false);
    }
  })
  
</script>

<script>document.body.classList.add('tw-list');</script>
{% endblock %}
